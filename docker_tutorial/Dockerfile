## The FROM statement decides the base image to use
## We use a lightweight alpine linux with miniconda3 pre-installed
## https://hub.docker.com/r/continuumio/miniconda3
## Other images can be found on dockerHub: https://hub.docker.com
##
## HINT: Always define a specific version of your operating system and avoid tags such as "latest" to improve reproducibility
##
## We use a base image with the Mamba package manager installed (Mamba: https://mamba.readthedocs.io/en/latest/) to facilitate the installation of R and its libraries
#FROM r-base:4.3.2
FROM condaforge/miniforge3:23.3.1-1

## Install system packages if necessary
#RUN apt-get update && apt-get install -y curl
#add lxqt-desktop cairo0

#RUN curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba
#RUN micromamba shell init --shell bash --root-prefix=~/micromamba && micromamba activate
## We use "mamba install" to select the packages of interest. Packages can be searched on https://anaconda.org/anaconda/repo
## HINT: Always define a specific version of your packages to improve reproducibility
## HINT: User the option "-y" to automatically answer "yes" to the install prompt. The image building process does not allow to answer interactive prompts
RUN mamba install -y r-base=4.3.2 r-ggplot2=3.4.4 r-argparse=2.2.2
## We define the command to run once the container has been built
## For more complex instructions we can provide a custom bash script that runs multiple commands
## The syntax below shows how to write an entrypoint with a command (Rscript) followed by options (example_plot.R)
## If the script is directly executable, the syntax simplifies to:
## ENTRYPOINT["./example_plot.R"]
##
## HINT: The whitespace after "ENTRYPOINT" is mandatory
ENTRYPOINT ["Rscript", "/input/myAnalysis.R", "--input", "/input/input.tsv", "--output", "/output/plot.png" ]
